<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ILIAS TV 2.0</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="h-screen flex flex-col">

<!-- Header, sidebar, and player HTML remains the same -->

<script>
document.addEventListener('DOMContentLoaded', function() {
  feather.replace();

  const username = "1100788991";
  const password = "14811";
  const baseApi = "http://38gb.pro:80/player_api.php"; // original server
  const proxy = "https://corsproxy.io/?"; // free CORS proxy

  let currentChannel = null;

  async function fetchApi(params) {
    const url = `${proxy}${baseApi}?username=${username}&password=${password}&${params}`;
    try {
      const res = await fetch(url);
      return await res.json();
    } catch (e) {
      console.error("API fetch error:", e);
      return null;
    }
  }

  async function loadCategories() {
    const categories = await fetchApi("action=get_live_categories");
    if (!categories) {
      alert("Failed to load categories");
      return;
    }
    const catDiv = document.getElementById("categories");
    catDiv.innerHTML = "";
    categories.forEach(cat => {
      const div = document.createElement("div");
      div.className = "p-3 hover:bg-white/5 cursor-pointer flex items-center";
      div.textContent = cat.category_name;
      div.onclick = () => loadChannels(cat.category_id);
      catDiv.appendChild(div);
    });
  }

  async function loadChannels(categoryId) {
    const channels = await fetchApi(`action=get_live_streams&category_id=${categoryId}`);
    const chanDiv = document.getElementById("channels");
    chanDiv.innerHTML = "";
    if (!channels || channels.length === 0) {
      chanDiv.innerHTML = "<div class='p-3 text-red-400'>No channels found</div>";
      return;
    }
    channels.forEach(chan => {
      const div = document.createElement("div");
      div.className = "channel-item p-3 cursor-pointer";
      div.textContent = chan.name;
      div.onclick = () => playChannel(chan);
      chanDiv.appendChild(div);
    });
  }

  function playChannel(chan) {
    currentChannel = chan;
    const video = document.getElementById("video");
    const streamUrl = `https://corsproxy.io/?${baseApi.replace("player_api.php","")}${chan.stream_id}.m3u8`; 
    if (Hls.isSupported()) {
      if (window.hls) { window.hls.destroy(); window.hls = null; }
      window.hls = new Hls();
      window.hls.loadSource(streamUrl);
      window.hls.attachMedia(video);
      window.hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
    } else {
      video.src = streamUrl;
      video.play();
    }
  }

  loadCategories();
});
</script>

</body>
</html>
